<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {margin:0}
    </style>
  </head>
  <body>
    <div>
    <script src="{% static 'js/three.js' %}"></script>
    <script type="module">
      import {NURBSCurve} from "{% static 'js/NURBSCurve.js' %}";
      import { OrbitControls } from "{% static 'js/OrbitControls.js' %}";
      import { TrackballControls } from "{% static 'js/TrackballControls.js' %}";
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf0f0f0);
      var viewsize = window.innerHeight;
      var ratio = window.innerWidth/window.innerHeight;
      var left = -viewsize*ratio/2;
      var right = viewsize*ratio/2;
      var top = viewsize/2;
      var bottom = -viewsize/2;
      const camera = new THREE.OrthographicCamera(left,right,top,bottom,-1000,1000);
      //const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000 );
      var CameraHelper = new THREE.CameraHelper(camera);
      scene.add(CameraHelper);
      camera.position.set( 100, 100, 100 );
      camera.lookAt( 0, 0, 0 );
      camera.up.set(0,0,1);
      const axesHelper = new THREE.AxesHelper( 10 );
      const plane = new THREE.Plane( new THREE.Vector3( 0,0,0 ), 0 );
      const helper = new THREE.PlaneHelper( plane, 1, 0xffff00 );
      scene.add( helper );
      scene.add( axesHelper );

      const renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      //const controls = new OrbitControls( camera, renderer.domElement );
      document.body.appendChild( renderer.domElement );
      const controls = new TrackballControls( camera, renderer.domElement );
      controls.rotateSpeed = 1.2;
      controls.zoomSpeed = 1.2;
      controls.panSpeed = 1.2;

      controls.keys = [ 65, 83, 68 ];

      const material = new THREE.LineBasicMaterial( { color: 0x0000ff } );



      var importHull = function(){
        //TEST!!
        let controlPoints  =  [];
        {% autoescape off %}
        var line = JSON.parse('{{testjson}}')
        {% endautoescape %}

        line.control.forEach(function(element){
        controlPoints.push(new THREE.Vector3(element[0],element[1],element[2]))

        })

        var knots =line.U;

        var curve = new NURBSCurve( 3, knots, controlPoints, 0, 0 );
  			var vertices = curve.getPoints( controlPoints.length * 7 );
  			var positions = new Float32Array( vertices.length * 3 );

  			vertices.forEach( function ( vertex, i ) {

  				vertex.toArray( positions, i * 3 );

  			} );

  			var geometry2 = new THREE.BufferGeometry();
  			geometry2.setAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );
        var line2 = new THREE.Line(geometry2,material);
        scene.add(line2);
  			//return geometry;
      }
      var render = function(){
        renderer.render( scene, camera );
    }
      var animation = function(){
        requestAnimationFrame(animation);
        controls.update();
        render();

      }
      importHull();
      animation();
    </script>

    </div>

  </body>
</html>
